!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-expression"),require("d3-color"),require("d3-array"),require("d3-format"),require("d3-time-format"),require("vega-scale"),require("vega-scenegraph"),require("vega-event-selector"),require("vega-dataflow")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-expression","d3-color","d3-array","d3-format","d3-time-format","vega-scale","vega-scenegraph","vega-event-selector","vega-dataflow"],t):t(e.vega=e.vega||{},e.vega,e.vega,e.d3,e.d3,e.d3,e.d3,e.vega,e.vega,e.vega,e.vega)}(this,function(e,t,n,a,r,i,o,l,s,u,d){"use strict";function c(e,n){t.error(e+' for "outer" push: '+t.stringValue(n))}function f(e){var t={};return function(n,a){return(t[a]||(t[a]=e(a)))(n)}}function p(e,t,n){return Mt.setMonth(e),Mt.setDate(t),jt(Mt,n)}function g(e){return p(e,1,"%B")}function h(e){return p(e,1,"%b")}function m(e){return p(0,2+e,"%A")}function v(e){return p(0,2+e,"%a")}function y(e){return 1+~~(new Date(e).getMonth()/3)}function x(e){return 1+~~(new Date(e).getUTCMonth()/3)}function b(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function k(){return b(this.context.dataflow,"warn",arguments)}function S(){return b(this.context.dataflow,"info",arguments)}function R(){return b(this.context.dataflow,"debug",arguments)}function w(){return"Math.sqrt(Math.pow(event.touches[0].clientX - event.touches[1].clientX, 2) + Math.pow(event.touches[0].clientY - event.touches[1].clientY, 2))"}function z(){return"Math.atan2(event.touches[1].clientY - event.touches[0].clientY,event.touches[1].clientX - event.touches[0].clientX)"}function P(e,t){var n=this.context.dataflow;Ct&&Ct.open?n.loader().sanitize(e,{context:"open",name:t}).then(function(e){Ct.open(e,t)}).catch(function(e){n.warn("Open url failed: "+e)}):n.warn("Open function can only be invoked in a browser.")}function O(){return Ct?Ct.screen:{}}function $(){return Ct?[Ct.innerWidth,Ct.innerHeight]:[void 0,void 0]}function D(e,n){var a;return t.isFunction(e)?e:t.isString(e)?(a=n.scales[e])&&a.value:void 0}function E(e,t,n){var a=Tt+n;if(!t.hasOwnProperty(a))try{t[a]=e.scaleRef(n)}catch(e){}}function _(e,t,n,a){if(t[0].type===qt)E(n,a,t[0].value);else if(t[0].type===Bt)for(e in n.scales)E(n,a,e)}function j(e,t){var n=D(e,(t||this).context);return n&&n.range?n.range():[]}function V(e,t){var n=D(e,(t||this).context);return n?n.domain():[]}function F(e,t){var n=D(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function M(e,t,n){return l.bandSpace(e||0,t||0,n||0)}function A(e,t){var n=D(e,(t||this).context);return n?n.copy():void 0}function W(e,t,n){var a=D(e,(n||this).context);return a?a(t):void 0}function C(e,n,a){var r=D(e,(a||this).context);return r?t.isArray(n)?(r.invertRange||r.invert)(n):(r.invert||r.invertExtent)(n):void 0}function L(e){return function(t,n,a){var r=D(t,(a||this).context);return r&&r.path[e](n)}}function q(e){var t=this.context.data[e];return t?t.values.value:[]}function B(e,n,a,r){n[0].type!==qt&&t.error("First argument to data functions must be a string literal.");var i=n[0].value,o=It+i;r.hasOwnProperty(o)||(r[o]=a.getData(i).tuplesRef())}function U(e,t,n){var a=this.context.data[e]["index:"+t],r=a?a.value.get(n):void 0;return r?r.count:r}function T(e,n,a,r){n[0].type!==qt&&t.error("First argument to indata must be a string literal."),n[1].type!==qt&&t.error("Second argument to indata must be a string literal.");var i=n[0].value,o=n[1].value,l=Ut+o;r.hasOwnProperty(l)||(r[l]=a.getData(i).indataRef(a,o))}function I(e){return e.data}function N(e,t){var n=q.call(t,e);return n.root&&n.root.lookup||Gt}function X(e,t,n){var a=N(e,this),r=a[t],i=a[n];return r&&i?r.path(i).map(I):void 0}function Y(e,t){var n=N(e,this)[t];return n?n.ancestors().map(I):void 0}function H(e){return function(t){for(var n in e)if("_id"!==n&&t[n]!==e[n])return!1;return!0}}function G(e,n){for(var a=n.fields,r=n.values,i=n.getter||(n.getter=[]),o=a.length,l=0;l<o;++l)if(i[l]=i[l]||t.field(a[l]),i[l](e)!==r[l])return!1;return!0}function J(e,n){for(var a,r=n.intervals,i=r.length,o=0;o<i;++o){if(a=r[o].getter||(r[o].getter=t.field(r[o].field)),r[o].extent[0]===r[o].extent[1])return!0;if(!Jt(a(e),r[o].extent))return!1}return!0}function K(e,t,n,a,r,i){for(var o,l,s=this.context.data[e],u=s?s.values.value:[],d=a!==Zt,c=u.length,f=0;f<c;++f)if(o=u[f],l=t===o.unit,!(r===tn&&l||r===en&&!l)&&(l=i(n,o),d^l))return l;return!c||d}function Q(e,t,n,a,r){return K.call(this,e,t,n,a,r,G)}function Z(e,t,n,a,r){return K.call(this,e,t,n,a,r,J)}function ee(e,t,n,a){for(var r,i,o,l,s=this.context.data[e],u=s?s.values.value:[],d={},c=0,f={},p=[],g=0,h=u.length;g<h;++g)r=u[g],i=r.unit,l=r.values[0],d[i]||(d[i]=++c),(t&&r.encodings[0]===t||n&&r.fields[0]===n)&&((o=f[l])||(f[l]=o={value:l,units:{},count:0}),o.units[i]||(o.units[i]=++o.count));for(l in f)a!==Zt&&(o=f[l]).count!==c||p.push(o.value);return p.length?p:void 0}function te(e,t,n,a){for(var r,i,o,l,s,u,d,c,f=a===Zt?ne:ae,p=this.context.data[e],g=p?p.values.value:[],h=0,m=g.length;h<m;++h)for(r=g[h].intervals,o=0,i=r.length;o<i;++o)l=r[o],(t&&l.encoding===t||n&&l.field===n)&&(s=l.extent,d=s[0],c=s[1],d>c&&(c=s[1],d=s[0]),u=u?f(u,d,c):[d,c]);return u&&u.length&&+u[0]!=+u[1]?u:void 0}function ne(e,t,n){return e[0]>t&&(e[0]=t),e[1]<n&&(e[1]=n),e}function ae(e,t,n){return n<e[0]||e[1]<t?[]:(e[0]<t&&(e[0]=t),e[1]>n&&(e[1]=n),e)}function re(e,t,n){return 1===arguments.length?nn[e]:(nn[e]=t,n&&(ln[e]=n),un&&(un.functions[e]=on+e),this)}function ie(e){var t=n.functions(e);an.forEach(function(e){t[e]=rn+e});for(var a in nn)t[a]=on+a;return t}function oe(e){return e===fn?cn:e||cn}function le(e,n){return(e.merge?se:e.stream?ue:e.type?de:t.error("Invalid stream specification: "+t.stringValue(e)))(e,n)}function se(e,t){var n=e.merge.map(function(e){return le(e,t)}),a=ce({merge:n},e,t);return t.addStream(a).id}function ue(e,t){var n=le(e.stream,t),a=ce({stream:n},e,t);return t.addStream(a).id}function de(e,t){var n=t.event(oe(e.source),e.type),a=ce({stream:n},e,t);return 1===Object.keys(a).length?n:t.addStream(a).id}function ce(e,n,a){var r=n.between;return r&&(2!==r.length&&t.error('Stream "between" parameter must have 2 entries: '+t.stringValue(n)),e.between=[le(r[0],a),le(r[1],a)]),r=n.filter?t.array(n.filter):[],(n.marktype||n.markname||n.markrole)&&r.push(fe(n.marktype,n.markname,n.markrole)),n.source===fn&&r.push("inScope(event.item)"),r.length&&(e.filter=dn("("+r.join(")&&(")+")").$expr),null!=(r=n.throttle)&&(e.throttle=+r),null!=(r=n.debounce)&&(e.debounce=+r),n.consume&&(e.consume=!0),e}function fe(e,t,n){var a="event.item";return a+(e&&"*"!==e?"&&"+a+".mark.marktype==='"+e+"'":"")+(n?"&&"+a+".mark.role==='"+n+"'":"")+(t?"&&"+a+".mark.name==='"+t+"'":"")}function pe(e,n){return t.isArray(e)?e.map(function(e){return pe(e,n)}):t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported parameter object: "+t.stringValue(e)):e}function ge(e,n,a,r){var i,o,l;if(e.signal)i="datum",l=Sn(e.signal,n,a,r);else if(e.group||e.parent){for(o=Math.max(1,e.level||1),i="item";o-- >0;)i+=".mark.group";e.parent?(l=e.parent,i+=".datum"):l=e.group}else e.datum?(i="datum",l=e.datum):t.error("Invalid field reference: "+t.stringValue(e));return e.signal||(t.isString(l)?(r[l]=1,l=t.splitAccessPath(l).map(t.stringValue).join("][")):l=ge(l,n,a,r)),i+"["+l+"]"}function he(e,n){if(!t.isString(e))return-1;var a=n.scaleType(e);return"band"===a||"point"===a?1:0}function me(e,n,a,r){var i;if(t.isString(e))i=Tt+e,a.hasOwnProperty(i)||(a[i]=n.scaleRef(e)),i=t.stringValue(i);else{for(i in n.scales)a[Tt+i]=n.scaleRef(i);i=t.stringValue(Tt)+"+"+(e.signal?"("+Sn(e.signal,n,a,r)+")":Rn(e,n,a,r))}return"_["+i+"]"}function ve(e,n,a,r){var i,o,l,s={},u="var o=item,datum=o.datum,$;";for(i in e)o=e[i],t.isArray(o)?u+=Dn(i,o,r,a,s):(l=On(i,o,r,a,s),u+=$n("o",i,l));return u+=bn(e,n),u+="return 1;",{$expr:u,$fields:Object.keys(s),$output:Object.keys(e)}}function ye(e){return t.isObject(e)?e:{value:e}}function xe(e,t,n){return null!=n?(e[t]={value:n},1):0}function be(e,n,a){for(var r in n)a&&a.hasOwnProperty(r)||(e[r]=t.extend(e[r]||{},n[r]));return e}function ke(e,t,n,a,r){var i,o;r=r||{},r.encoders={$encode:i={}},e=Se(e,t,n,a.config);for(o in e)i[o]=ve(e[o],t,r,a);return r}function Se(e,n,a,r){var i,o;"legend"!=a&&0!==String(a).indexOf("axis")||(a=null),r=a===_n?r.group:a===En||r[n=a]?t.extend({},r.mark,r[n]):{},i={};for(o in r)Re(o,e)||("fill"===o||"stroke"===o)&&(Re("fill",e)||Re("stroke",e))||(i[o]={value:r[o]});return e=t.extend({},e),e.enter=t.extend(i,e.enter),e}function Re(e,t){return t.enter&&t.enter[e]||t.update&&t.update[e]}function we(e,t,n,a){this.id=-1,this.type=e,this.value=t,this.params=n,a&&(this.parent=a)}function ze(e,t,n,a){return new we(e,t,n,a)}function Pe(e,t){return ze("Operator",e,t)}function Oe(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function $e(e,t){return t?{$field:e,$name:t}:{$field:e}}function De(e,t){return{$compare:e,$order:t}}function Ee(e){return{$key:e}}function _e(e){return t.isObject(e)?(e.order===Qn?"-":"+")+je(e.op,e.field):""}function je(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}function Ve(e){return e&&e.signal}function Fe(e){return function(t,n,a){return ze(e,n,t||void 0,a)}}function Me(e,t,n){var a,r,i,o={};for(r=0,i=e.params.length;r<i;++r)a=e.params[r],o[a.name]=Ae(a,t,n);return o}function Ae(e,n,a){var r=e.type,i=n[e.name];return"index"===r?Ce(e,n,a):void 0===i?void(e.required&&t.error("Missing required "+t.stringValue(n.type)+" parameter: "+t.stringValue(e.name))):"param"===r?Le(e,n,a):"projection"===r?a.projectionRef(n[e.name]):e.array&&!Ve(i)?i.map(function(t){return We(e,t,a)}):We(e,i,a)}function We(e,n,a){var r=e.type;if(Ve(n))return Ie(r)?t.error("Expression references can not be signals."):Ne(r)?a.fieldRef(n):Xe(r)?a.compareRef(n):a.signalRef(n.signal);var i=e.expr||Ne(r);return i&&Be(n)?dn(n.expr,a):i&&Ue(n)?$e(n.field):Ie(r)?dn(n,a):Te(r)?Oe(a.getData(n).values):Ne(r)?$e(n):Xe(r)?a.compareRef(n):n}function Ce(e,n,a){return t.isString(n.from)||t.error('Lookup "from" parameter must be a string literal.'),a.getData(n.from).lookupRef(a,n.key)}function Le(e,n,a){var r=n[e.name];return e.array?(t.isArray(r)||t.error("Expected an array of sub-parameters. Instead: "+t.stringValue(r)),r.map(function(t){return qe(e,t,a)})):qe(e,r,a)}function qe(e,n,a){var r,i,o,l,s;for(l=0,s=e.params.length;l<s;++l){i=e.params[l];for(o in i.key)if(i.key[o]!==n[o]){i=null;break}if(i)break}return i||t.error("Unsupported parameter: "+t.stringValue(n)),r=t.extend(Me(i,n,a),i.key),Oe(a.add(pa(r)))}function Be(e){return e&&e.expr}function Ue(e){return e&&e.field}function Te(e){return"data"===e}function Ie(e){return"expr"===e}function Ne(e){return"field"===e}function Xe(e){return"compare"===e}function Ye(e,t,n,a,r){this.scope=e,this.input=t,this.output=n,this.values=a,this.aggregate=r,this.index={}}function He(e){return t.isString(e)?e:null}function Ge(e,t,n){var a,r=je(n.op,n.field);if(t.ops){for(var i=0,o=t.as.length;i<o;++i)if(t.as[i]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((a=n.op.signal)?e.signalRef(a):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function Je(e,t,n,a,r,i,o){var l,s,u=t[n]||(t[n]={}),d=_e(i),c=He(r);if(null!=c&&(e=t.scope,c+=d?"|"+d:"",l=u[c]),!l){var f=i?{field:Kn,pulse:t.countsRef(e,r,i)}:{field:e.fieldRef(r),pulse:Oe(t.output)};d&&(f.sort=e.sortRef(i)),s=e.add(ze(a,void 0,f)),o&&(t.index[r]=s),l=Oe(s),null!=c&&(u[c]=l)}return l}function Ke(e,t){return null!=e?e:t}function Qe(e,t,n){var a,r=+t.symbolSize;return a=n&&n.update&&n.update.fontSize,a||(a=n&&n.enter&&n.enter.fontSize),a&&(a=a.value),a||(a=+t.labelFontSize),e.size?{$expr:"Math.max(Math.ceil(Math.sqrt(_.scale(datum))),"+a+")"}:Math.max(Math.ceil(Math.sqrt(r)),a)}function Ze(e){var t={};return xe(t,"fill",e.fillColor)+xe(t,"stroke",e.strokeColor)+xe(t,"strokeWidth",e.strokeWidth)+xe(t,"strokeDash",e.strokeDash)+xe(t,"cornerRadius",e.cornerRadius)?t:void 0}function et(e){return Ma.hasOwnProperty(e)}function tt(e){return"quantile"===e}function nt(e,n){return t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported object: "+t.stringValue(e)):e}function at(e,t){return e.signal?t.signalRef(e.signal):e.map(function(e){return nt(e,t)})}function rt(e){t.error("Can not find data set: "+t.stringValue(e))}function it(e,n,a){return e?e.signal?a.signalRef(e.signal):(t.isArray(e)?ot:e.fields?st:lt)(e,n,a):void(null==n.domainMin&&null==n.domainMax||t.error("No scale domain defined for domainMin/domainMax to override."))}function ot(e,t,n){return e.map(function(e){return nt(e,n)})}function lt(e,t,n){var a=n.getData(e.data);return a||rt(e.data),et(t.type)?a.valuesRef(n,e.field,ct(e.sort,!1)):tt(t.type)?a.domainRef(n,e.field):a.extentRef(n,e.field)}function st(e,n,a){var r=e.data,i=e.fields.reduce(function(e,n){return n=t.isString(n)?{data:r,field:n}:t.isArray(n)||n.signal?ut(n,a):n,e.push(n),e},[]);return(et(n.type)?dt:tt(n.type)?ft:pt)(e,a,i)}function ut(e,n){var a="_:vega:_"+ja++,r=na({});return t.isArray(e)?r.value={$ingest:e}:e.signal&&n.signalRef("modify("+t.stringValue(a)+","+e.signal+", true)"),n.addDataPipeline(a,[r,ba({})]),{data:a,field:"data"}}function dt(e,t,n){var a,r,i,o;return a=n.map(function(e){var n=t.getData(e.data);return n||rt(e.data),n.countsRef(t,e.field)}),r=t.add(Zn({groupby:Kn,ops:["sum"],fields:[t.fieldRef("count")],as:["count"],pulse:a})),i=t.add(na({pulse:Oe(r)})),o=t.add(Ra({field:Kn,sort:t.sortRef(ct(e.sort,!0)),pulse:Oe(i)})),Oe(o)}function ct(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field?t.error("Multiple domain scales can not sort by field."):n&&e.op&&"count"!==e.op&&t.error("Multiple domain scales support op count only."):t.error("No field provided for sort aggregate op: "+e.op):t.isObject(e)?e.field="key":e={field:"key"}),e}function ft(e,t,n){var a=n.map(function(e){var n=t.getData(e.data);return n||rt(e.data),n.domainRef(t,e.field)});return Oe(t.add(fa({values:a})))}function pt(e,t,n){var a=n.map(function(e){var n=t.getData(e.data);return n||rt(e.data),n.extentRef(t,e.field)});return Oe(t.add(ca({extents:a})))}function gt(e,t){t.interpolate=nt(e.type||e),null!=e.gamma&&(t.interpolateGamma=nt(e.gamma))}function ht(e,n,a){var r=e.range,i=n.config.range;if(r.signal)return n.signalRef(r.signal);if(t.isString(r)){if(i&&i.hasOwnProperty(r))return e=t.extend({},e,{range:i[r]}),ht(e,n,a);"width"===r?r=[0,{signal:"width"}]:"height"===r?r=et(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t.error("Unrecognized scale range value: "+t.stringValue(r))}else{if(r.scheme)return a.scheme=nt(r.scheme,n),r.extent&&(a.schemeExtent=at(r.extent,n)),void(r.count&&(a.schemeCount=nt(r.count,n)));if(r.step)return void(a.rangeStep=nt(r.step,n));if(et(e.type)&&!t.isArray(r))return it(r,e,n);t.isArray(r)||t.error("Unsupported range type: "+t.stringValue(r))}return r.map(function(e){return nt(e,n)})}function mt(e,n,a,r){var i,o,l,s,u,d,c=e.text,f=e.orient||n.orient,p=e.anchor||n.anchor,g=f===Ln||f===Cn?-1:1,h=f===Cn||f===qn,m={group:h?"width":"height"},v={};return v.enter=i={opacity:{value:0}},xe(i,"fill",n.color),xe(i,"font",n.font),xe(i,"fontSize",n.fontSize),xe(i,"fontWeight",n.fontWeight),v.exit={opacity:{value:0}},v.update=o={opacity:{value:1},text:t.isObject(c)?c:{value:c+""},offset:ye(e.offset||0)},"start"===p?(u=0,d="left"):"end"===p?(u=1,d="right"):(u=.5,d="center"),l={field:m,mult:u},s=g<0?{value:0}:h?{field:{group:"height"}}:{field:{group:"width"}},h?(o.x=l,o.y=s,o.angle={value:0},o.baseline={value:f===Cn?"bottom":"top"}):(o.x=s,o.y=l,o.angle={value:90*g},o.baseline={value:"bottom"}),o.align={value:d},o.limit={field:m},xe(o,"angle",n.angle),xe(o,"baseline",n.baseline),xe(o,"limit",n.limit),Fn(An,jn,null,r,v,a)}function vt(e,t){var n=[];e.transform&&e.transform.forEach(function(e){n.push(wa(e,t))}),e.on&&e.on.forEach(function(n){Da(n,t,e.name)}),t.addDataPipeline(e.name,yt(e,t,n))}function yt(e,t,n){var a,r,i,o,l,s=[],u=null,d=!1,c=!1;for(e.values?s.push(u=xt({$ingest:e.values,$format:e.format})):e.url?s.push(u=xt({$request:e.url,$format:e.format})):e.source&&(a=t.getData(e.source),u=a.output,s.push(null)),r=0,i=n.length;r<i;++r)o=n[r],l=o.metadata,u||l.source||s.push(u=xt()),s.push(o),l.generates&&(c=!0),l.modifies&&!c&&(d=!0),l.source?u=o:l.changes&&(u=null);return a&&(s[0]=va({derive:d,pulse:Oe(a.output)}),d&&s.splice(1,0,xt())),u||s.push(xt()),s.push(ba({})),s}function xt(e){var t=na({},e);return t.metadata={source:!0},t}function bt(e,t){return{scale:e.scale,range:t}}function kt(e,n){var a,r,i,o,l,s=n.config;return n.background=e.background||s.background,l=Oe(n.root=n.add(Pe())),n.addSignal("width",e.width||-1),n.addSignal("height",e.height||-1),n.addSignal("padding",Ot(e.padding,s)),t.array(e.signals).forEach(function(e){Xa[e.name]||Dt(e,n)}),r=n.add(na()),i=be({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),i=n.add(ia(ke(i,Mn,_n,n,{pulse:Oe(r)}))),o=n.add(Sa({layout:n.objectProperty(e.layout),legendMargin:s.legendMargin,autosize:Pt(e.autosize,s),mark:l,pulse:Oe(i)})),n.operators.pop(),n.pushState(Oe(i),Oe(o),null),Na(e,n,!0),n.operators.push(o),a=n.add(ta({mark:l,pulse:Oe(o)})),a=n.add(ya({pulse:Oe(a)})),a=n.add(ba({pulse:Oe(a)})),n.addData("root",new Ye(n,r,r,a)),n}function St(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Rt(e){this.config=e.config,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function wt(e){var n,a,r="{",i=0;for(n in e)a=e[n],r+=(++i>1?",":"")+t.stringValue(n)+":"+(t.isObject(a)?a.signal||wt(a):t.stringValue(a));return r+"}"}function zt(){return{padding:0,autosize:"pad",background:null,group:null,mark:null,arc:{fill:Ka},area:{fill:Ka},image:null,line:{stroke:Ka,strokeWidth:Ja},path:{stroke:Ka},rect:{fill:Ka},rule:{stroke:Qa},shape:{stroke:Ka},symbol:{fill:Ka,size:64},text:{fill:Qa,font:"sans-serif",fontSize:11},point:{size:Ga,strokeWidth:Ja,shape:"circle"},circle:{size:Ga,strokeWidth:Ja},square:{size:Ga,strokeWidth:Ja},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:Qa,grid:!1,gridWidth:1,gridColor:er,gridDash:[],gridOpacity:1,labels:!0,labelAngle:0,labelColor:Qa,labelFont:"sans-serif",labelFontSize:10,labelPadding:2,labelLimit:180,ticks:!0,tickRound:!0,tickSize:5,tickWidth:1,tickColor:Qa,titleAlign:"center",titlePadding:2,titleColor:Qa,titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},legend:{orient:"right",offset:18,padding:0,entryPadding:5,titlePadding:5,gradientWidth:100,gradientHeight:20,gradientStrokeColor:er,gradientStrokeWidth:0,gradientLabelBaseline:"top",gradientLabelOffset:2,labelColor:Qa,labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,labelLimit:160,symbolType:"circle",symbolSize:100,symbolColor:Za,symbolStrokeWidth:1.5,titleColor:Qa,titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleAlign:"left",titleBaseline:"top",titleLimit:180},title:{orient:"top",anchor:"middle",offset:2,color:Qa,font:"sans-serif",fontSize:13,fontWeight:"bold"},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues",extent:[.2,1]},heatmap:{scheme:"viridis"},ramp:{scheme:"blues",extent:[.2,1]},diverging:{scheme:"blueorange"},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}var Pt=function(e,n){return e=e||n.autosize,t.isObject(e)?e:(e=e||"pad",{type:e})},Ot=function(e,n){return e=e||n.padding,t.isObject(e)?e:(e=+e||0,{top:e,bottom:e,left:e,right:e})},$t=["value","update","react","bind"],Dt=function(e,t){var n=e.name;if("outer"===e.push)t.signals[n]||c("No prior signal definition",n),$t.forEach(function(t){void 0!==e[t]&&c("Invalid property ",t)});else{var a=t.addSignal(n,e.value);!1===e.react&&(a.react=!1),e.bind&&t.addBinding(n,e.bind)}},Et=f(i.format),_t=f(o.utcFormat),jt=f(o.timeFormat),Vt=f(o.utcParse),Ft=f(o.timeParse),Mt=new Date(2e3,0,1),At=function(e){var t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},Wt=function(e,t,n){var a,r=e[0],i=e[1];return i<r&&(a=i,i=r,r=a),a=i-r,a>=n-t?[t,n]:[Math.min(Math.max(r,t),n-a),Math.min(Math.max(i,a),n)]},Ct="undefined"!=typeof window&&window||null,Lt=function(e){return e[e.length-1]-e[0]||0},qt="Literal",Bt="Identifier",Ut="@",Tt="%",It=":",Nt=function(e,t,n,a){var r=s.Gradient(t,n),i=e.domain(),o=i[0],u=i[i.length-1],d=l.scaleFraction(e,o,u);e.ticks&&(i=e.ticks(+a||15),o!==i[0]&&i.unshift(o),u!==i[i.length-1]&&i.push(u));for(var c=0,f=i.length;c<f;++c)r.stop(d(i[c]),e(i[c]));return r},Xt=L("area"),Yt=L("bounds"),Ht=L("centroid"),Gt={},Jt=function(e,t){var n,a=t[0],r=t[t.length-1];return a>r&&(n=a,a=r,r=n),a<=e&&e<=r},Kt=function(e,t,n){if(e){var a=this.context.dataflow,r=e.mark.source;a.pulse(r,a.changeset().encode(e,t))}return void 0!==n?n:e},Qt=function(e,n,a,r,i,o){var l,s,u=this.context.dataflow,d=this.context.data[e],c=d.input,f=d.changes,p=u.stamp();if(!1===u._trigger||!(c.value.length||n||r))return 0;if((!f||f.stamp<p)&&(d.changes=f=u.changeset(),f.stamp=p,u.runAfter(function(){d.modified=!0,u.pulse(c,f).run()})),a&&(l=!0===a?t.truthy:t.isArray(a)||null!=a._id?a:H(a),f.remove(l)),n&&f.insert(n),r&&(l=H(r),c.value.some(l)?f.remove(l):f.insert(r)),i)for(s in o)f.modify(i,s,o[s]);return 1},Zt="union",en="unit",tn="others",nn={isArray:t.isArray,isBoolean:t.isBoolean,isDate:t.isDate,isNumber:t.isNumber,isObject:t.isObject,isRegExp:t.isRegExp,isString:t.isString,toBoolean:t.toBoolean,toDate:t.toDate,toNumber:t.toNumber,toString:t.toString,pad:t.pad,truncate:t.truncate,rgb:a.rgb,lab:a.lab,hcl:a.hcl,hsl:a.hsl,sequence:r.range,format:Et,utcFormat:_t,utcParse:Vt,timeFormat:jt,timeParse:Ft,monthFormat:g,monthAbbrevFormat:h,dayFormat:m,dayAbbrevFormat:v,quarter:y,utcquarter:x,warn:k,info:S,debug:R,inScope:At,clampRange:Wt,pinchDistance:w,pinchAngle:z,open:P,screen:O,windowsize:$,span:Lt,bandspace:M,inrange:Jt,encode:Kt,modify:Qt},an=["view","item","group","xy","x","y"],rn="event.vega.",on="this.",ln={};re("bandwidth",F,_),re("copy",A,_),re("domain",V,_),re("range",j,_),re("invert",C,_),re("scale",W,_),re("gradient",Nt,_),re("geoArea",Xt,_),re("geoBounds",Yt,_),re("geoCentroid",Ht,_),re("indata",U,T),re("data",q,B),re("vlPoint",Q,B),re("vlInterval",Z,B),re("vlPointDomain",ee,B),re("vlIntervalDomain",te,B),re("treePath",X,B),re("treeAncestors",Y,B);var sn={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_["+t.stringValue("$"+e)+"]"},functions:ie,constants:n.constants,visitors:ln},un=n.codegen(sn),dn=function(e,a,r){var i,o,l={};try{i=n.parse(e)}catch(n){t.error("Expression parse error: "+t.stringValue(e))}return i.visit(function(e){if("CallExpression"===e.type){var t=e.callee.name,n=sn.visitors[t];n&&n(t,e.arguments,a,l)}}),o=un(i),o.globals.forEach(function(e){var t="$"+e;!l.hasOwnProperty(t)&&a.getSignal(e)&&(l[t]=a.signalRef(e))}),{$expr:r?r+"return("+o.code+");":o.code,$fields:o.fields,$params:l}},cn="view",fn="scope",pn=function(e,t){return e.signal?t.getSignal(e.signal).id:le(e,t)},gn="var datum=event.item&&event.item.datum;",hn=function(e,n,a){var r,i=e.events,o=e.update,l=e.encode,s=[],d="";i||t.error("Signal update missing events specification."),t.isString(i)&&(i=u.selector(i)),i=t.array(i).filter(function(e){return e.signal?(s.push(e),0):1}),i.length&&s.push(i.length>1?{merge:i}:i[0]),null!=l&&(o&&t.error("Signal encode and update are mutually exclusive."),o="encode(item(),"+t.stringValue(l)+")"),d=t.isString(o)?dn(o,n,gn):null!=o.expr?dn(o.expr,n,gn):null!=o.value?o.value:null!=o.signal?{$expr:"_.value",$params:{value:n.signalRef(o.signal)}}:t.error("Invalid signal update specification."),r={target:a,update:d},e.force&&(r.options={force:!0}),s.forEach(function(e){e={source:pn(e,n)},n.addUpdate(t.extend(e,r))})},mn=function(e,t){var n=t.getSignal(e.name);if(e.update){var a=dn(e.update,t);n.update=a.$expr,n.params=a.$params}e.on&&e.on.forEach(function(e){hn(e,t,n.id)})},vn=function(e,t){var n={};for(var a in e)"name"!==a&&(n[a]=pe(e[a],t));t.addProjection(e.name,n)},yn=t.toSet(["rule"]),xn=t.toSet(["group","image","rect"]),bn=function(e,t){var n="";return yn[t]?n:(e.x2&&(e.x?(xn[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):e.width?n+="o.x=o.x2-o.width;":n+="o.x=o.x2;"),e.xc&&(e.width?n+="o.x=o.xc-o.width/2;":n+="o.x=o.xc;"),e.y2&&(e.y?(xn[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):e.height?n+="o.y=o.y2-o.height;":n+="o.y=o.y2;"),e.yc&&(e.height?n+="o.y=o.yc-o.height/2;":n+="o.y=o.yc;"),n)},kn=function(e,t,n,a){function r(e,r,i,o){return"this."+e+"("+[On(null,r,t,n,a),On(null,i,t,n,a),On(null,o,t,n,a)].join(",")+").toString()"}return e.c?r("hcl",e.h,e.c,e.l):e.h||e.s?r("hsl",e.h,e.s,e.l):e.l||e.a?r("lab",e.l,e.a,e.b):e.r||e.g||e.b?r("rgb",e.r,e.g,e.b):null},Sn=function(e,n,a,r){var i=dn(e,n);return i.$fields.forEach(function(e){r[e]=1}),t.extend(a,i.$params),i.$expr},Rn=function(e,n,a,r){return ge(t.isObject(e)?e:{datum:e},n,a,r)},wn=function(e,t,n,a,r){var i,o,l,s=me(e.scale,n,a,r);return null!=e.range?(i=+e.range,o=s+".range()",t=0===i?o+"[0]":"($="+o+","+(1===i?"$[$.length-1]":"$[0]+"+i+"*($[$.length-1]-$[0])")+")"):(void 0!==t&&(t=s+"("+t+")"),e.band&&(l=he(e.scale,n))&&(o=s+".bandwidth",i=+e.band,i=o+"()"+(1===i?"":"*"+i),l<0&&(i="("+o+"?"+i+":0)"),t=(t?t+"+":"")+i,e.extra&&(t="(datum.extra?"+s+"(datum.extra.value):"+t+")")),null==t&&(t="0")),t},zn=function(e,n,a,r){return"this.gradient("+me(e.gradient,n,a,r)+","+t.stringValue(e.start)+","+t.stringValue(e.stop)+","+t.stringValue(e.count)+")"},Pn=function(e,n,a,r){return t.isObject(e)?"("+On(null,e,n,a,r)+")":e},On=function(e,n,a,r,i){if(null!=n.gradient)return zn(n,a,r,i);var o=n.signal?Sn(n.signal,a,r,i):n.color?kn(n.color,a,r,i):null!=n.field?Rn(n.field,a,r,i):void 0!==n.value?t.stringValue(n.value):void 0;return null!=n.scale&&(o=wn(n,o,a,r,i)),void 0===o&&(o=null),null!=n.exponent&&(o="Math.pow("+o+","+Pn(n.exponent,a,r,i)+")"),null!=n.mult&&(o+="*"+Pn(n.mult,a,r,i)),null!=n.offset&&(o+="+"+Pn(n.offset,a,r,i)),n.round&&(o="Math.round("+o+")"),o},$n=function(e,n,a){return e+"["+t.stringValue(n)+"]="+a+";"},Dn=function(e,t,n,a,r){var i="";return t.forEach(function(t){var o=On(e,t,n,a,r);i+=t.test?Sn(t.test,n,a,r)+"?"+o+":":o}),$n("o",e,i)},En="mark",_n="frame",jn="title",Vn={name:1,interactive:1},Fn=function(e,t,n,a,r,i){return{type:e,name:i?i.name:void 0,role:t,key:n,from:a,interactive:!(!i||!i.interactive),encode:be(r,i,Vn)}},Mn="group",An="text",Wn=function(e,t,n){var a,r,i={value:0},o={};return o.enter=a={opacity:i,x:i,y:i},xe(a,"width",t.gradientWidth),xe(a,"height",t.gradientHeight),xe(a,"stroke",t.gradientStrokeColor),xe(a,"strokeWidth",t.gradientStrokeWidth),o.exit={opacity:i},o.update=r={x:i,y:i,fill:{gradient:e},opacity:{value:1}},xe(r,"width",t.gradientWidth),xe(r,"height",t.gradientHeight),Fn("rect","legend-gradient",void 0,void 0,o,n)},Cn="top",Ln="left",qn="bottom",Bn="value",Un=["shape","size","fill","stroke","strokeDash","opacity"],Tn=function(e,t,n,a){var r,i,o={value:0},l={};return l.enter=r={opacity:o,text:{field:"label"}},xe(r,"fill",t.labelColor),xe(r,"font",t.labelFont),xe(r,"fontSize",t.labelFontSize),xe(r,"baseline",t.gradientLabelBaseline),xe(r,"limit",t.gradientLabelLimit),l.exit={opacity:o},l.update=i={opacity:{value:1}},r.x=i.x={field:"perc",mult:t.gradientWidth},r.y=i.y={value:t.gradientHeight,offset:t.gradientLabelOffset},r.align=i.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},Fn(An,"legend-label","perc",a,l,n)},In=function(e,t,n,a){var r,i,o={value:0},l={};return l.enter=r={opacity:o,text:{field:"label"}},xe(r,"align",t.labelAlign),xe(r,"baseline",t.labelBaseline),xe(r,"fill",t.labelColor),xe(r,"font",t.labelFont),xe(r,"fontSize",t.labelFontSize),xe(r,"limit",t.labelLimit),l.exit={opacity:o},l.update=i={opacity:{value:1}},r.x=i.x={field:"offset",offset:t.labelOffset},r.y=i.y={field:"size",mult:.5,offset:{field:"total",offset:{field:{group:"entryPadding"},mult:{field:"index"}}}},Fn(An,"legend-label",Bn,a,l,n)},Nn=function(e,t,n,a){var r,i,o={value:0},l={};return l.enter=r={opacity:o},xe(r,"shape",t.symbolType),xe(r,"size",t.symbolSize),xe(r,"strokeWidth",t.symbolStrokeWidth),e.fill||xe(r,"stroke",t.symbolColor),l.exit={opacity:o},l.update=i={opacity:{value:1}},r.x=i.x={field:"offset",mult:.5},r.y=i.y={field:"size",mult:.5,offset:{field:"total",offset:{field:{group:"entryPadding"},mult:{field:"index"}}}},Un.forEach(function(t){e[t]&&(i[t]=r[t]={scale:e[t],field:Bn})}),Fn("symbol","legend-symbol",Bn,a,l,n)},Xn=function(e,t,n,a){var r,i={value:0},o=e.title,l={};return l.enter=r={x:{field:{group:"padding"}},y:{field:{group:"padding"}},opacity:i},xe(r,"align",t.titleAlign),xe(r,"baseline",t.titleBaseline),xe(r,"fill",t.titleColor),xe(r,"font",t.titleFont),xe(r,"fontSize",t.titleFontSize),xe(r,"fontWeight",t.titleFontWeight),xe(r,"limit",t.titleLimit),l.exit={opacity:i},l.update={opacity:{value:1},text:o&&o.signal?{signal:o.signal}:{value:o+""}},Fn(An,"legend-title",null,a,l,n)},Yn=function(e,t,n,a,r,i){return{type:Mn,name:t,role:e,from:n,interactive:a,encode:r,marks:i}},Hn=function(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")?e.type===Mn?"scope":t||En:t},Gn=function(e){return{clip:e.clip||!1,interactive:!1!==e.interactive,marktype:e.type,name:e.name||void 0,role:e.role||Hn(e),zindex:+e.zindex||void 0}},Jn=function(e){return e},Kn=$e("key"),Qn="descending",Zn=Fe("Aggregate"),ea=Fe("AxisTicks"),ta=Fe("Bound"),na=Fe("Collect"),aa=Fe("Compare"),ra=Fe("DataJoin"),ia=Fe("Encode"),oa=Fe("Facet"),la=Fe("Field"),sa=Fe("Key"),ua=Fe("LegendEntries"),da=Fe("Mark"),ca=Fe("MultiExtent"),fa=Fe("MultiValues"),pa=Fe("Params"),ga=Fe("PreFacet"),ha=Fe("Projection"),ma=Fe("Proxy"),va=Fe("Relay"),ya=Fe("Render"),xa=Fe("Scale"),ba=Fe("Sieve"),ka=Fe("SortItems"),Sa=Fe("ViewLayout"),Ra=Fe("Values"),wa=function(e,n){var a=d.definition(e.type);a||t.error("Unrecognized transform type: "+t.stringValue(e.type));var r=ze(a.type,null,Me(a,e,n));return e.signal&&n.addSignal(e.signal,n.proxy(r)),r.metadata=a.metadata||{},r},za=function(e,n,a){var r,i,o,l,s;return e?(r=e.facet)&&(n||t.error("Only group marks can be faceted."),null!=r.field?l=s=Oe(a.getData(r.data).output):(i=a.keyRef(r.groupby),e.data?s=Oe(a.getData(e.data).aggregate):(o=wa(t.extend({type:"aggregate",groupby:t.array(r.groupby)},r.aggregate)),o.params.key=i,o.params.pulse=Oe(a.getData(r.data).output),l=s=Oe(a.add(o))))):l=Oe(a.add(na(null,[{}]))),l||(l=e.$ref?e:Oe(e.mark?a.getData(Jn(e.mark)).output:a.getData(e.data).output)),{key:i,pulse:l,parent:s}};Ye.fromEntries=function(e,t){var n=t.length,a=1,r=t[0],i=t[n-1],o=t[n-2],l=null;for(e.add(t[0]);a<n;++a)t[a].params.pulse=Oe(t[a-1]),e.add(t[a]),"Aggregate"===t[a].type&&(l=t[a]);return new Ye(e,r,o,i,l)};var Pa=Ye.prototype;Pa.countsRef=function(e,t,n){var a,r,i,o=this,l=o.counts||(o.counts={}),s=He(t);return null!=s&&(e=o.scope,a=l[s]),a?n&&n.field&&Ge(e,a.agg.params,n):(i={groupby:e.fieldRef(t,"key"),pulse:Oe(o.output)},n&&n.field&&Ge(e,i,n),r=e.add(Zn(i)),a=e.add(na({pulse:Oe(r)})),a={agg:r,ref:Oe(a)},null!=s&&(l[s]=a)),a.ref},Pa.tuplesRef=function(){return Oe(this.values)},Pa.extentRef=function(e,t){return Je(e,this,"extent","Extent",t,!1)},
Pa.domainRef=function(e,t){return Je(e,this,"domain","Values",t,!1)},Pa.valuesRef=function(e,t,n){return Je(e,this,"vals","Values",t,n||!0)},Pa.lookupRef=function(e,t){return Je(e,this,"lookup","TupleIndex",t,!1)},Pa.indataRef=function(e,t){return Je(e,this,"indata","TupleIndex",t,!0,!0)};var Oa=function(e,n,a){var r,i,o,l,s=e.from.facet,u=s.name,d=Oe(n.getData(s.data).output);s.name||t.error("Facet must have a name: "+t.stringValue(s)),s.data||t.error("Facet must reference a data set: "+t.stringValue(s)),s.field?l=n.add(ga({field:n.fieldRef(s.field),pulse:d})):s.groupby?l=n.add(oa({key:n.keyRef(s.groupby),group:Oe(n.proxy(a.parent)),pulse:d})):t.error("Facet must specify groupby or field: "+t.stringValue(s)),r=n.fork(),i=r.add(na()),o=r.add(ba({pulse:Oe(i)})),r.addData(u,new Ye(r,i,i,o)),r.addSignal("parent",null),l.params.subflow={$subflow:Na(e,r).toRuntime()}},$a=function(e,t,n){var a=t.add(ga({pulse:n.pulse})),r=t.fork();r.add(ba()),r.addSignal("parent",null),a.params.subflow={$subflow:Na(e,r).toRuntime()}},Da=function(e,t,n){var a,r,i=e.remove,o=e.insert,l=e.toggle,s=e.modify,u=e.values,d=t.add(Pe());a="if("+e.trigger+',modify("'+n+'",'+[o,i,l,s,u].map(function(e){return null==e?"null":e}).join(",")+"),0)",r=dn(a,t),d.update=r.$expr,d.params=r.$params},Ea=function(e,n){var a,r,i,o,l,s,u,d,c,f,p,g,h,m=Hn(e),v=e.type===Mn,y=e.from&&e.from.facet,x=e.layout||"scope"===m||m===_n,b=m===En||x||y;i=za(e.from,v,n),r=n.add(ra({key:i.key||(e.key?$e(e.key):void 0),pulse:i.pulse,clean:!v})),c=Oe(r),r=o=n.add(na({pulse:c})),r=n.add(da({markdef:Gn(e),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:Oe(r)})),f=Oe(r),r=n.add(ia(ke(e.encode,e.type,m,n,{pulse:f}))),r.params.parent=n.encode(),e.transform&&e.transform.forEach(function(e){var a=wa(e,n);(a.metadata.generates||a.metadata.changes)&&t.error("Mark transforms should not generate new data."),a.params.pulse=Oe(r),n.add(r=a)}),e.sort&&(r=n.add(ka({sort:n.compareRef(e.sort),pulse:Oe(r)}))),p=Oe(r),(y||x)&&(x=n.add(Sa({layout:n.objectProperty(e.layout),legendMargin:n.config.legendMargin,mark:f,pulse:p})),g=Oe(x)),l=n.add(ta({mark:f,pulse:g||p})),h=Oe(l),v&&(b&&(a=n.operators,a.pop(),x&&a.pop()),n.pushState(p,g||h,c),y?Oa(e,n,i):b?$a(e,n,i):Na(e,n),n.popState(),b&&(x&&a.push(x),a.push(l))),s=n.add(ya({pulse:h})),u=n.add(ba({pulse:h},void 0,n.parent())),null!=e.name&&(d=Jn(e.name),n.addData(d,new Ye(n,o,s,u)),e.on&&e.on.forEach(function(e){(e.insert||e.remove||e.toggle)&&t.error("Marks only support modify triggers."),Da(e,n,d)}))},_a=function(e,n){var a,r,i,o,l,s,u,d,c=e.type||"symbol",f=n.config.legend,p=e.name||void 0,g=e.encode||{},h=!!e.interactive,m=e.size||e.shape||e.fill||e.stroke||e.strokeDash||e.opacity;return m||t.error("Missing valid scale for legend."),a={orient:Ke(e.orient,f.orient),title:null!=e.title},r=Oe(n.add(na(null,[a]))),s=be({enter:Ze(f),update:{offset:ye(Ke(e.offset,f.offset)),padding:ye(Ke(e.padding,f.padding)),titlePadding:ye(Ke(e.titlePadding,f.titlePadding))}},g.legend),u={update:{x:{field:{group:"padding"}},y:{field:{group:"padding"}},entryPadding:ye(Ke(e.entryPadding,f.entryPadding))}},"gradient"===c?(i=Oe(n.add(ua({type:"gradient",scale:n.scaleRef(m),count:n.property(e.tickCount),values:n.property(e.values),formatSpecifier:n.property(e.format)}))),d=[Wn(m,f,g.gradient),Tn(0,f,g.labels,i)]):(i=Oe(n.add(ua({size:Qe(e,f,g.labels),scale:n.scaleRef(m),count:n.property(e.tickCount),values:n.property(e.values),formatSpecifier:n.property(e.format)}))),d=[Nn(e,f,g.symbols,i),In(0,f,g.labels,i)]),d=[Yn("legend-entry",null,r,h,u,d)],a.title&&(l=Xn(e,f,g.title,r),u.update.y.offset={field:{group:"titlePadding"},offset:l.encode.update.fontSize||l.encode.enter.fontSize},d.push(l)),o=Yn("legend",p,r,h,s,d),e.zindex&&(o.zindex=e.zindex),Ea(o,n)},ja=0,Va=["identity","ordinal","band","point","bin-linear","bin-ordinal","linear","pow","sqrt","log","sequential","time","utc","quantize","quantile","threshold"],Fa=t.toSet(Va),Ma=t.toSet(Va.slice(1,6)),Aa=function(e,n){var a,r,i=e.type||"linear";Fa.hasOwnProperty(i)||t.error("Unrecognized scale type: "+t.stringValue(i)),a={type:i,domain:it(e.domain,e,n)},null!=e.range&&(a.range=ht(e,n,a)),null!=e.interpolate&&gt(e.interpolate,a);for(r in e)a.hasOwnProperty(r)||"name"===r||(a[r]=nt(e[r],n));n.addScale(e.name,a)},Wa=function(e,n){e=t.isString(e)?{text:e}:e;var a,r,i,o=n.config.title,l=t.extend({},e.encode);return a={orient:null!=e.orient?e.orient:o.orient},r=Oe(n.add(na(null,[a]))),l.name=e.name,l.interactive=e.interactive,i=mt(e,o,l,r),e.zindex&&(i.zindex=e.zindex),Ea(i,n)},Ca=function(e,n){var a=n.config,r=e.orient,i=r===Cn||r===qn?a.axisX:a.axisY,o=a["axis"+r[0].toUpperCase()+r.slice(1)],l="band"===n.scaleType(e.scale)&&a.axisBand;return i||o||l?t.extend({},a.axis,i,o,l):a.axis},La=function(e,t,n,a){var r,i,o,l,s,u=e.orient,d={value:0},c={};return c.enter=r={opacity:d},xe(r,"stroke",t.tickColor),xe(r,"strokeWidth",t.tickWidth),c.exit={opacity:d},c.update=i={opacity:{value:1}},u===Cn||u===qn?(o="x",s="y"):(o="y",s="x"),l=o+"2",r[s]=d,i[o]=r[o]=bt(e,0),i[l]=r[l]=bt(e,1),Fn("rule","axis-domain",null,a,c,n)},qa=function(e,t,n,a){var r,i,o,l,s,u,d,c,f=e.orient,p=e.gridScale,g=f===Ln||f===Cn?1:-1,h=g*e.offset||0,m={value:0},v={};return v.enter=r={opacity:m},xe(r,"stroke",t.gridColor),xe(r,"strokeWidth",t.gridWidth),xe(r,"strokeDash",t.gridDash),v.exit=i={opacity:m},v.update=o={},xe(o,"opacity",t.gridOpacity),l={scale:e.scale,field:Bn,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra},f===Cn||f===qn?(s="x",u="y",c="height"):(s="y",u="x",c="width"),d=u+"2",o[s]=r[s]=i[s]=l,p?(r[u]={scale:p,range:0,mult:g,offset:h},o[d]=r[d]={scale:p,range:1,mult:g,offset:h}):(r[u]={value:h},o[d]=r[d]={signal:c,mult:g,offset:h}),Fn("rule","axis-grid",Bn,a,v,n)},Ba=function(e,t,n,a,r){var i,o,l,s,u,d=e.orient,c=d===Ln||d===Cn?-1:1,f={value:0},p={};return p.enter=i={opacity:f},xe(i,"stroke",t.tickColor),xe(i,"strokeWidth",t.tickWidth),p.exit=o={opacity:f},p.update=l={opacity:{value:1}},s=ye(r),s.mult=c,u={scale:e.scale,field:Bn,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra},d===Cn||d===qn?(l.y=i.y=f,l.y2=i.y2=s,l.x=i.x=o.x=u):(l.x=i.x=f,l.x2=i.x2=s,l.y=i.y=o.y=u),Fn("rule","axis-tick",Bn,a,p,n)},Ua=function(e,t,n,a,r){var i,o,l,s,u,d=e.orient,c=d===Ln||d===Cn?-1:1,f=null!=e.labelPadding?e.labelPadding:t.labelPadding,p={value:0},g={};return g.enter=i={opacity:p},xe(i,"angle",t.labelAngle),xe(i,"fill",t.labelColor),xe(i,"font",t.labelFont),xe(i,"fontSize",t.labelFontSize),xe(i,"limit",t.labelLimit),g.exit=o={opacity:p},g.update=l={opacity:{value:1},text:{field:"label"}},s=ye(r),s.mult=c,s.offset=ye(f),s.offset.mult=c,u={scale:e.scale,field:Bn,band:.5},d===Cn||d===qn?(l.y=i.y=s,l.x=i.x=o.x=u,xe(l,"align","center"),xe(l,"baseline",d===Cn?"bottom":"top")):(l.x=i.x=s,l.y=i.y=o.y=u,xe(l,"align","right"===d?"left":"right"),xe(l,"baseline","middle")),Fn(An,"axis-label",Bn,a,g,n)},Ta=function(e,t,n,a){var r,i,o,l=e.orient,s=e.title,u=l===Ln||l===Cn?-1:1,d=l===Cn||l===qn,c={};return c.enter=r={opacity:{value:0}},xe(r,"align",t.titleAlign),xe(r,"fill",t.titleColor),xe(r,"font",t.titleFont),xe(r,"fontSize",t.titleFontSize),xe(r,"fontWeight",t.titleFontWeight),xe(r,"limit",t.titleLimit),c.exit={opacity:{value:0}},c.update=i={opacity:{value:1},text:s&&s.signal?{signal:s.signal}:{value:s+""}},o={scale:e.scale,range:.5},d?(i.x=o,i.angle={value:0},i.baseline={value:l===Cn?"bottom":"top"}):(i.y=o,i.angle={value:90*u},i.baseline={value:"bottom"}),xe(i,"angle",t.titleAngle),xe(i,"baseline",t.titleBaseline),!xe(i,"x",t.titleX)&&d&&!Re(n,"x")&&(c.enter.auto={value:!0}),!xe(i,"y",t.titleY)&&!d&&!Re(n,"y")&&(c.enter.auto={value:!0}),Fn(An,"axis-title",null,a,c,n)},Ia=function(e,t){var n,a,r,i,o,l,s,u=Ca(e,t),d=e.name||void 0,c=e.encode||{},f=!!e.interactive;return n={orient:e.orient,ticks:null!=e.ticks?!!e.ticks:u.ticks,labels:null!=e.labels?!!e.labels:u.labels,grid:null!=e.grid?!!e.grid:u.grid,domain:null!=e.domain?!!e.domain:u.domain,title:null!=e.title},a=Oe(t.add(na({},[n]))),l=be({update:{range:{signal:'abs(span(range("'+e.scale+'")))'},offset:ye(e.offset||0),position:ye(e.position||0),titlePadding:ye(e.titlePadding||u.titlePadding),minExtent:ye(e.minExtent||u.minExtent),maxExtent:ye(e.maxExtent||u.maxExtent)}},c.axis),r=Oe(t.add(ea({scale:t.scaleRef(e.scale),extra:u.tickExtra,count:t.property(e.tickCount),values:t.property(e.values),formatSpecifier:t.property(e.format)}))),s=[],n.grid&&s.push(qa(e,u,c.grid,r)),n.ticks&&(i=null!=e.tickSize?e.tickSize:u.tickSize,s.push(Ba(e,u,c.ticks,r,i))),n.labels&&(i=n.ticks?i:0,s.push(Ua(e,u,c.labels,r,i))),n.domain&&s.push(La(e,u,c.domain,a)),n.title&&s.push(Ta(e,u,c.title,a)),o=Yn("axis",d,a,f,l,s),e.zindex&&(o.zindex=e.zindex),Ea(o,t)},Na=function(e,n,a){var r=t.array(e.signals);return a||r.forEach(function(e){Dt(e,n)}),t.array(e.projections).forEach(function(e){vn(e,n)}),t.array(e.data).forEach(function(e){vt(e,n)}),t.array(e.scales).forEach(function(e){Aa(e,n)}),r.forEach(function(e){mn(e,n)}),t.array(e.axes).forEach(function(e){Ia(e,n)}),t.array(e.marks).forEach(function(e){Ea(e,n)}),t.array(e.legends).forEach(function(e){_a(e,n)}),e.title&&Wa(e.title,n),n.parseLambdas(),n},Xa=t.toSet(["width","height","padding"]),Ya=St.prototype=Rt.prototype;Ya.fork=function(){return new Rt(this)},Ya.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings}},Ya.id=function(){return(this._subid?this._subid+":":0)+this._id++},Ya.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},Ya.proxy=function(e){var t=e instanceof we?Oe(e):e;return this.add(ma({value:t}))},Ya.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},Ya.addUpdate=function(e){return this.updates.push(e),e},Ya.finish=function(){function e(e,t,n){var a,r;e&&(a=e.data||(e.data={}),r=a[t]||(a[t]=[]),r.push(n))}var t,n;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;for(t in this.data){n=this.data[t],e(n.input,t,"input"),e(n.output,t,"output"),e(n.values,t,"values");for(var a in n.index)e(n.index[a],t,"index:"+a)}return this},Ya.pushState=function(e,t,n){this._encode.push(Oe(this.add(ba({pulse:e})))),this._parent.push(t),this._lookup.push(n?Oe(this.proxy(n)):null),this._markpath.push(-1)},Ya.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},Ya.parent=function(){return t.peek(this._parent)},Ya.encode=function(){return t.peek(this._encode)},Ya.lookup=function(){return t.peek(this._lookup)},Ya.markpath=function(){var e=this._markpath;return++e[e.length-1]},Ya.fieldRef=function(e,n){if(t.isString(e))return $e(e,n);e.signal||t.error("Unsupported field reference: "+t.stringValue(e));var a,r=e.signal,i=this.field[r];return i||(a={name:this.signalRef(r)},n&&(a.as=n),this.field[r]=i=Oe(this.add(la(a)))),i},Ya.compareRef=function(e){function n(e){return Ve(e)?(r=!0,Oe(a[e.signal])):e}var a=this.signals,r=!1,i=t.array(e.field).map(n),o=t.array(e.order).map(n);return r?Oe(this.add(aa({fields:i,orders:o}))):De(i,o)},Ya.keyRef=function(e){function n(e){return Ve(e)?(r=!0,Oe(a[e.signal])):e}var a=this.signals,r=!1;return e=t.array(e).map(n),r?Oe(this.add(sa({fields:e}))):Ee(e)},Ya.sortRef=function(e){if(!e)return e;var t=[je(e.op,e.field),"_id"],n=e.order||"ascending";return n.signal?Oe(this.add(aa({fields:t,orders:[n=this.signalRef(n.signal),n]}))):De(t,[n,n])},Ya.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var a=this.id();this.streams.push({id:a,source:e,type:t}),this.events[n]=a}return this.events[n]},Ya.addSignal=function(e,n){this.signals.hasOwnProperty(e)&&t.error("Duplicate signal name: "+t.stringValue(e));var a=n instanceof we?n:this.add(Pe(n));return this.signals[e]=a},Ya.getSignal=function(e){return this.signals[e]||t.error("Unrecognized signal name: "+t.stringValue(e)),this.signals[e]},Ya.signalRef=function(e){return this.signals[e]?Oe(this.signals[e]):(this.lambdas[e]||(this.lambdas[e]=this.add(Pe(null))),Oe(this.lambdas[e]))},Ya.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var a=e[t],r=dn(a,this),i=this.lambdas[a];i.params=r.$params,i.update=r.$expr}},Ya.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},Ya.objectProperty=function(e){return e&&t.isObject(e)?this.signalRef(e.signal||wt(e)):e},Ya.addBinding=function(e,n){this.bindings||t.error("Nested signals do not support binding: "+t.stringValue(e)),this.bindings.push(t.extend({signal:e},n))},Ya.addScaleProj=function(e,n){this.scales.hasOwnProperty(e)&&t.error("Duplicate scale or projection name: "+t.stringValue(e)),this.scales[e]=this.add(n)},Ya.addScale=function(e,t){this.addScaleProj(e,xa(t))},Ya.addProjection=function(e,t){this.addScaleProj(e,ha(t))},Ya.getScale=function(e){return this.scales[e]||t.error("Unrecognized scale name: "+t.stringValue(e)),this.scales[e]},Ya.projectionRef=Ya.scaleRef=function(e){return Oe(this.getScale(e))},Ya.projectionType=Ya.scaleType=function(e){return this.getScale(e).params.type},Ya.addData=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.data[e]=n},Ya.getData=function(e){return this.data[e]||t.error("Undefined data set name: "+t.stringValue(e)),this.data[e]},Ya.addDataPipeline=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.addData(e,Ye.fromEntries(this,n))};var Ha=function(e){var n,a=zt();for(n in e)a[n]=t.isObject(a[n])?t.extend(a[n],e[n]):a[n]=e[n];return a},Ga=30,Ja=2,Ka="#4c78a8",Qa="#000",Za="#888",er="#ddd",tr=function(e,t){return kt(e,new St(Ha(t||e.config))).toRuntime()};e.parse=tr,e.signal=Dt,e.signalUpdates=mn,e.stream=pn,e.codeGenerator=un,e.functionContext=nn,e.expressionFunction=re,e.MarkRole=En,e.FrameRole=_n,e.ScopeRole="scope",e.AxisRole="axis",e.AxisDomainRole="axis-domain",e.AxisGridRole="axis-grid",e.AxisLabelRole="axis-label",e.AxisTickRole="axis-tick",e.AxisTitleRole="axis-title",e.LegendRole="legend",e.LegendEntryRole="legend-entry",e.LegendLabelRole="legend-label",e.LegendSymbolRole="legend-symbol",e.LegendTitleRole="legend-title",e.Scope=St,e.DataScope=Ye,e.formatLocale=i.formatDefaultLocale,e.timeFormatLocale=o.timeFormatDefaultLocale,Object.defineProperty(e,"__esModule",{value:!0})});