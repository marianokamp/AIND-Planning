!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.vega=n.vega||{})}(this,function(n){"use strict";function t(n){return null==n?null:n.fname}function e(n){return null==n?null:n.fields}function r(n){return l(n)?"["+n.map(r)+"]":f(n)||a(n)?JSON.stringify(n).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):n}function u(n,t,e){var r=[t].concat([].slice.call(e));console[n].apply(console,r)}var o=function(n,t,e){return n.fields=t||[],n.fname=e,n},i=function(n){throw Error(n)},c=function(n){function t(){o.push(a+n.substring(e,r)),a="",e=r+1}var e,r,u,o=[],c=null,l=0,f=n.length,a="";for(n+="",e=r=0;r<f;++r)if(u=n[r],"\\"===u)a+=n.substring(e,r),e=++r;else if(u===c)t(),c=null,l=-1;else{if(c)continue;e===l&&'"'===u?(e=r+1,c=u):e===l&&"'"===u?(e=r+1,c=u):"."!==u||l?"["===u?(r>e&&t(),l=e=r+1):"]"===u&&(l||i("Access path missing open bracket: "+n),l>0&&t(),l=0,e=r+1):r>e?t():e=r+1}return l&&i("Access path missing closing bracket: "+n),c&&i("Access path missing closing quote: "+n),r>e&&(++r,t()),o},l=Array.isArray,f=function(n){return n===Object(n)},a=function(n){return"string"==typeof n},s=function(n,t){var e=c(n),u="return _["+e.map(r).join("][")+"];";return o(Function("_",u),[n=1===e.length?e[0]:n],t||n)},p=[],g=s("id"),h=o(function(n){return n},p,"identity"),v=o(function(){return 0},p,"zero"),y=o(function(){return 1},p,"one"),b=o(function(){return!0},p,"true"),m=o(function(){return!1},p,"false"),d=0,j=1,O=2,x=3,A=function(n){var t=n||d;return{level:function(n){return arguments.length?(t=+n,this):t},warn:function(){return t>=j&&u("warn","WARN",arguments),this},info:function(){return t>=O&&u("log","INFO",arguments),this},debug:function(){return t>=x&&u("log","DEBUG",arguments),this}}},k=function(n){return null!=n?l(n)?n:[n]:[]},D=function(n,t){var e,u,i,l,f,a,s,p,g=[],h=(n=k(n)).map(function(n,t){return null==n?null:(g.push(t),c(n).map(r).join("]["))}),v=g.length-1,y=k(t),b="var u,v;return ";if(v<0)return null;for(u=0;u<=v;++u)e=g[u],i=h[e],l="(u=a["+i+"])",f="(v=b["+i+"])",a="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",s="descending"!==y[e]?(p=1,-1):(p=-1,1),b+="("+l+"<"+f+"||u==null)&&v!=null?"+s+":(u>v||v==null)&&u!=null?"+p+":"+a+"!==u&&v===v?"+s+":v!==v&&u===u?"+p+(e<v?":":":0");return o(Function("a","b",b+";"),n.filter(function(n){return null!=n}))},z=function(n){return"function"==typeof n},N=function(n){return z(n)?n:function(){return n}},E=function(n){for(var t,e,r=1,u=arguments.length;r<u;++r){t=arguments[r];for(e in t)n[e]=t[e]}return n},F=function(n,t){var e,r,u,o,i,c=-1,l=n.length;if(null==t){for(;++c<l;)if(null!=(r=n[c])&&r>=r){e=u=r;break}for(o=i=c;++c<l;)null!=(r=n[c])&&(e>r&&(e=r,o=c),u<r&&(u=r,i=c))}else{for(;++c<l;)if(null!=(r=t(n[c],c,n))&&r>=r){e=u=r;break}for(o=i=c;++c<l;)null!=(r=t(n[c],c,n))&&(e>r&&(e=r,o=c),u<r&&(u=r,i=c))}return[o,i]},S={},_=function(n){function t(n){return u.hasOwnProperty(n)&&u[n]!==S}var e,r,u={};return e={size:0,empty:0,object:u,has:t,get:function(n){return t(n)?u[n]:void 0},set:function(n,r){return t(n)||(++e.size,u[n]===S&&--e.empty),u[n]=r,this},delete:function(n){return t(n)&&(--e.size,++e.empty,u[n]=S),this},clear:function(){e.size=e.empty=0,e.object=u={}},test:function(n){return arguments.length?(r=n,e):r},clean:function(){var n,t,o={},i=0;for(n in u)t=u[n],t===S||r&&r(t)||(o[n]=t,++i);e.size=i,e.empty=0,e.object=u=o}},n&&Object.keys(n).forEach(function(t){e.set(t,n[t])}),e},w=function(n,t){var e=n.prototype=Object.create(t.prototype);return e.constructor=n,e},M=function(n){return"boolean"==typeof n},B=function(n){return"[object Date]"===Object.prototype.toString.call(n)},I=function(n){return"number"==typeof n},P=function(n){return"[object RegExp]"===Object.prototype.toString.call(n)},R=function(n){n=n?k(n):n;var t=n&&n.length?Function("_","return ''+"+n.map(function(n){return"_["+c(n).map(r).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return o(t,n,"key")},W=function(n,t,e,r){var u=t.length,o=e.length;if(!o)return t;if(!u)return e;for(var i=r||new t.constructor(u+o),c=0,l=0,f=0;c<u&&l<o;++f)i[f]=n(t[c],e[l])>0?e[l++]:t[c++];for(;c<u;++c,++f)i[f]=t[c];for(;l<o;++l,++f)i[f]=e[l];return i},q=function(n,t){for(var e="";--t>=0;)e+=n;return e},G=function(n,t,e,r){var u=e||" ",o=n+"",i=t-o.length;return i<=0?o:"left"===r?q(u,i)+o:"center"===r?q(u,~~(i/2))+o+q(u,Math.ceil(i/2)):o+q(u,i)},J=function(n){return n[n.length-1]},U=function(n){return null==n||""===n?null:!(!n||"false"===n)&&!!n},V=function(n,t){return null==n||""===n?null:t?t(n):Date.parse(n)},C=function(n){return null==n||""===n?null:+n},H=function(n){return null==n||""===n?null:n+""},K=function(n){for(var t={},e=0,r=n.length;e<r;++e)t[n[e]]=1;return t},L=function(n,t,e,r){var u=null!=r?r:"â€¦",o=n+"",i=o.length,c=Math.max(0,t-u.length);return i<=t?o:"left"===e?u+o.slice(i-c):"center"===e?o.slice(0,Math.ceil(c/2))+u+o.slice(i-~~(c/2)):o.slice(0,c)+u},Q=function(n,t,e){if(n){var r,u=0,o=n.length;if(t)for(;u<o;++u)(r=t(n[u]))&&e(r,u,n);else n.forEach(e)}};n.accessor=o,n.accessorName=t,n.accessorFields=e,n.id=g,n.identity=h,n.zero=v,n.one=y,n.truthy=b,n.falsy=m,n.logger=A,n.None=d,n.Warn=j,n.Info=O,n.Debug=x,n.array=k,n.compare=D,n.constant=N,n.error=i,n.extend=E,n.extentIndex=F,n.fastmap=_,n.field=s,n.inherits=w,n.isArray=l,n.isBoolean=M,n.isDate=B,n.isFunction=z,n.isNumber=I,n.isObject=f,n.isRegExp=P,n.isString=a,n.key=R,n.merge=W,n.pad=G,n.peek=J,n.repeat=q,n.splitAccessPath=c,n.stringValue=r,n.toBoolean=U,n.toDate=V,n.toNumber=C,n.toString=H,n.toSet=K,n.truncate=L,n.visitArray=Q,Object.defineProperty(n,"__esModule",{value:!0})});